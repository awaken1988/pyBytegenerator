<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <h>Trainingsplan</h>

    
    <div id="excercise-div">
      <form id="excercise-form">
        <select id="excercise-select">

        </select>
      </form>
    </div>

    <div id="input-div">
      <div id="input-Duration-div" hidden>
        Duration: <input type="number" value="0"/> minutes
      </div>
    </div>

    <button id="exercise_add" type="button">Click Me!</button> 

    <script>
      var excercise_map = new Map();

      function selected_excersize_template() {
        var name = $('#excercise-select option:selected').text();
        var data = excercise_map.get(name);

        return {'name': name, 'data': data};
      }

      //load excercises
      function load_excercise_list() {
        $.getJSON("/api/excercise_template_list", function(data) {
          console.log(data);
          
          excercise_map.clear();

          $.each(data, function(key, val) {
            console.log(key+' '+val);
            excercise_map.set(key, val)
            $('<option value="'+key+'"/>'+key+'</option>').appendTo('#excercise-select')
          })

        })
      };

      //show menu
      $('#excercise-select').change(function() {
        var name = $('#excercise-select option:selected').text();
        var data = excercise_map.get(name);

        console.log('select changed ' + name);

        data.value_type.forEach(type_name => {
          $('#input-'+type_name+'-div').show('slow','linear');
        });
      });

      //exercise_add
      $('#exercise_add').click(function() {
        var excercise_tmpl =  selected_excersize_template()
        console.log(excercise_tmpl);
      
        const post_data = {
          'excercise_template': excercise_tmpl.data,
          'duration': 0,
          'weigth': 0,
          'repetition': 0,
        };

        $.ajax({
          type: "POST",
          url: "/api/excersice_add",
          data: JSON.stringify(post_data),
          contentType : 'application/json',
        });

      });


      $(document).ready( function() {
        load_excercise_list();        
      });

    </script>

  </body>
</html>